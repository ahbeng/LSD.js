<!doctype html>
<html manifest="LSD.appcache">
<head><title></title></head>
<body>
<script src="js/vendor/localforage.js"></script>
<script>
  function handleRequest(event) {
    var data = JSON.parse(event.data);
    switch (data.method) {
      case 'getItem':
        localforage.getItem(data.key, function (value) {
          event.source.postMessage(JSON.stringify({id: data.id, method: data.method, key: data.key, value: value}), event.origin);
        });
        break;
      case 'setItem':
        localforage.setItem(data.key, data.value, function (value) {
          event.source.postMessage(JSON.stringify({id: data.id, method: data.method, key: data.key}), event.origin);
        });
        break;
      case 'removeItem':
        localforage.removeItem(data.key, function () {
          event.source.postMessage(JSON.stringify({id: data.id, method: data.method, key: data.key}), event.origin);
        });
        break;
      case 'clear':
        localforage.clear(function () {
          event.source.postMessage(JSON.stringify({id: data.id, method: data.method}), event.origin);
        });
        break;
    }
  }

  if (window.addEventListener) {
    window.addEventListener('message', handleRequest, false);
  } else if (window.attachEvent) {
    window.attachEvent('onmessage', handleRequest);
  }
</script>
</body>
</html>
